{#
/**
 * This file is part of the Presta Bundle project.
 *
 * (c) Nicolas Bastien nbastien@prestaconcept.net
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
/**
 * Theme edition
 */
#}

{% extends base_template %}

{% block title %}
    Theme - {{ theme.name }}
{% endblock %}
{% block breadcrumb %}
    ##breadcrumb##
{% endblock %}

{% block content %}
<div id="modal" class="modal modal-large hide">
  <div class="modal-header">
    <h3 id="modal-title">Edit block</h3>
  </div>
  <div id="modal-body" class="modal-body">
      <div id="modal-loader">
          <img src="{{ asset('bundles/prestasonataadmin/img/loader.gif') }}" />
      </div>
      <div id="modal-content"></div>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal"><i class="icon-ok icon-remove"></i>&nbsp;Close</a>
    <a href="#" class="btn btn-primary" onclick="CMSContent.submitModalForm();"><i class="icon-ok icon-white"></i>&nbsp;Save changes</a>
  </div>
</div>

<div class="row-fluid">
    <div class="span5 center">
        <img src="{{ asset(theme.screenshot) }}" class="sonata-ba-img-box" />
    </div>
    <div class="span7">
        <table class="table ">
            <tbody>
                <tr>
                    <th>Name</th><td>{{ theme.name }}</td>
                </tr>
                <tr>
                    <th>Description</th><td>{{ theme.description }}</td>
                </tr>
                <tr>
                    <th>Zones</th>
                    <td>
                        <ul>
                        {% for zone in theme.zones %}
                            {% if (zone.name) %}<li><strong>{{ zone.name }}</strong></li>{% endif %}
                        {% endfor %}
                        </ul>
                    </td>
                </tr>
                <tr>
                    <th>Page templates</th>
                    <td>
                        <ul>
                        {% for template in theme.pageTemplates %}
                            <li><strong>{{ template.name }}</strong>{# : <p>{{ template.path }}</p> #}</li>
                        {% endfor %}
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td colspan="2"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="row-fluid">
    <div class="span12 form-horizontal">
        <script type="text/javascript"> </script>
        {{ sonata_block_render({
            'type': 'presta_cms.block.website.selector',
            'settings': {'website_id' : website_id, 'locale' : locale}
        }) }}        
        <fieldset>
            <legend>Content</legend>
            <div class="control-group">
            <table class="table table-bordered page-content-admin" cellspacing="5">
                <colgroup>
                    {% for i in range(1, theme.cols) %}
                        <col width="{{ 100 / theme.cols }} %" />
                    {% endfor %}
                </colgroup>
                <tr>
                    {% set currentCol = 0 %}
                    {% for zone in theme.zones %}
                        {% if (currentCol == theme.cols) %}
                            {% set currentCol = zone.cols %}
                            </tr><tr>
                        {% else %}
                            {% set currentCol = currentCol + zone.cols %}
                        {% endif %}
                        <td colspan="{{ zone.cols }}" rowspan="" class="">
                            {% if (zone.name) %}
                                <div class="page-zone {% if (zone.blocks|length == 0 and zone.canAddBlock == false) %}page-zone-disabled{% endif %}">
                                    <h3>{{ zone.name }}</h3>
                                    {% if (zone.blocks) %}
                                        <div class="page-zone-block-container">
                                        {% for block in zone.blocks %}
                                            <div class="page-zone-block">
                                                <h4>{{ block.type }}</h4>
                                                <div class="block-actions">
                                                    {% if (block.isEditable) %}
                                                        <a block-id="{{ block.id }}" class="action-edit">&nbsp;</a>
                                                    {% endif %}
                                                    {% if (block.isDeletable) %}
                                                        <a href="#" class="action-delete">&nbsp;</a>
                                                    {% endif %}
                                                </div>
                                                <div id="block-content-{{ block.id }}" class="block-content">
                                                    {{ sonata_block_render(block) }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>                
            </table>
        </fieldset>
    </div>
</div>
 <script type="text/javascript"> 
    {#
    /**
     * Initialize CMSContent
     * Specific function so it can be called asynchrone
     */
    #}
    function CMSContentInit() {
        {% if (website) %}
        CMSContent.init(
            "{{ path('presta_cms_theme_edit_block', { 'website_id': website.id, 'locale': website.locale }) }}",
            "{{ path('presta_cms_theme_render_block', { 'locale': website.locale }) }}"
        );
        {% endif %}
    }
    $(document).ready(function() {
        CMSContentInit();
    }); 
    var website_selector_url = "{{ path('presta_cms_theme_edit', { 'name': 'default' }) }}";
</script>
{% endblock %}