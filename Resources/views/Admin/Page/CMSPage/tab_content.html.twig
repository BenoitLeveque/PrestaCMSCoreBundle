{#
/**
 * This file is part of the Presta Bundle project.
 *
 * (c) Nicolas Bastien <nbastien@prestaconcept.net>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
/**
 * Tab content for page edition
 */
#}
<div id="modal" class="modal modal-large hide">
  <div class="modal-header">
    <h3 id="modal-title">{{ 'modal.edit.block.title'|trans }}</h3>
  </div>
  <div id="modal-body" class="modal-body">
      <div id="modal-loader">
          <img src="{{ asset('bundles/prestasonataadmin/img/loader.gif') }}" />
      </div>
      <div id="modal-content"></div>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal"><i class="icon-ok icon-remove"></i>&nbsp;{{ 'button.close'|trans }}</a>
    <a href="#" class="btn btn-primary" onclick="CMSContent.submitModalForm();"><i class="icon-ok icon-white"></i>&nbsp;{{ 'button.save'|trans }}</a>
  </div>
</div>

<div class="">
    <div class="">
        <fieldset>
            <legend>{{ 'page_cms.content.title'|trans }}</legend>
            <div class="control-group">
            <table class="table table-bordered page-content-admin" cellspacing="5">
                <colgroup>
                    {% for i in range(1, 12) %}
                        <col width="{{ 100 / 12 }} %" />
                    {% endfor %}
                </colgroup>
                <tr>
                    {% set currentCol = 0 %}
                    {% for zone in template.zones %}
                        {% if (currentCol == 12) %}
                            {% set currentCol = zone.cols %}
                            </tr><tr>
                        {% else %}
                            {% set currentCol = currentCol + zone.cols %}
                        {% endif %}
                        <td colspan="{{ zone.cols }}" class="col{{ zone.cols }}">
                            {% if (zone.name) %}
                                <div id="{{ zone.name}}" class="page-zone {% if (zone.blocks|length == 0 and zone.canAddBlock == false) %}page-zone-disabled{% endif %}">
                                    <h3>{{ ['zone.name.', zone.name]|join|trans }}</h3>
                                    {% if (zone.blocks) %}
                                        <div class="page-zone-block-container">
                                        {% for block in zone.blocks %}
                                            <div class="page-zone-block {{ block.type }}">
                                                <h4>{{ ['block.title.', block.type]|join|trans }}</h4>
                                                <div class="block-actions">
                                                    {% if (block.isEditable) %}
                                                        <a block-id="{{ block.id }}" class="action-edit">&nbsp;</a>
                                                    {% endif %}
                                                    {% if (block.isDeletable) %}
                                                        <a href="#" class="action-delete">&nbsp;</a>
                                                    {% endif %}
                                                </div>
                                                <div id="block-content-{{ block.id }}" class="block-content">
                                                    {{ sonata_block_render(block) }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>                
            </table>
        </fieldset>
        <script type="text/javascript"> 
            {#
            /**
            * Initialize CMSContent
            * Specific function so it can be called asynchrone
            */
            #}

            function CMSContentInit() {
                CMSContent.init(
                    "{{ path('presta_cms_page_revision_edit_block', { 'website_id': website.id, 'locale': website.locale }) }}",
                    "{{ path('presta_cms_page_revision_render_block', { 'locale': website.locale }) }}"
                );
            }
//            $(document).ready(function() {
//                CMSContentInit();
//            });
        </script>        
    </div>
</div>